---
tags:
  - terraform
  - state
  - backend
  - collaboration
  - intermediate
created: 2025-01-20
updated: 2025-01-20
aliases:
  - Terraform State
  - í…Œë¼í¼ ìƒíƒœ
  - tfstate
description: Terraform State íŒŒì¼ì˜ ì—­í• ê³¼ ê´€ë¦¬ ë°©ë²•, Remote Backend ì„¤ì •ìœ¼ë¡œ íŒ€ í˜‘ì—… í™˜ê²½ êµ¬ì¶•í•˜ê¸°
status: published
category: guide
---

# 06. Terraform ìƒíƒœ ê´€ë¦¬

> [!info] ê°œìš”
> Terraform StateëŠ” ì¸í”„ë¼ì˜ í˜„ì¬ ìƒíƒœë¥¼ ì¶”ì í•˜ëŠ” JSON íŒŒì¼ì…ë‹ˆë‹¤. ì‹¤ì œ ì¸í”„ë¼ì™€ êµ¬ì„± íŒŒì¼ ê°„ì˜ ë§¤í•‘ì„ ê´€ë¦¬í•˜ë©°, Terraformì´ ë³€ê²½ì‚¬í•­ì„ íŒŒì•…í•˜ëŠ” í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.

## ğŸ“‘ ëª©ì°¨

- [[#âš¡ ë¹ ë¥¸ ì‹œì‘]]
- [[#ğŸ¯ State íŒŒì¼ì˜ ì—­í• ]]
- [[#ğŸ“‚ State íŒŒì¼ êµ¬ì¡°]]
- [[#ğŸ”’ ë¡œì»¬ vs ì›ê²© State]]
- [[#â˜ï¸ Remote Backend ì„¤ì •]]
- [[#ğŸ¤ í˜‘ì—… ì „ëµ]]
- [[#ğŸ› ï¸ State ê´€ë¦¬ ëª…ë ¹ì–´]]
- [[#âš ï¸ ì£¼ì˜ì‚¬í•­ê³¼ Best Practices]]

---

## âš¡ ë¹ ë¥¸ ì‹œì‘

> [!example] State ê´€ë¦¬ í•µì‹¬ ëª…ë ¹ì–´
> ê°€ì¥ ìì£¼ ì‚¬ìš©í•˜ëŠ” State ê´€ë ¨ ëª…ë ¹ì–´ë“¤ì…ë‹ˆë‹¤.

```bash
# State ì¡°íšŒ
terraform state list                    # ë¦¬ì†ŒìŠ¤ ëª©ë¡
terraform state show aws_instance.web   # íŠ¹ì • ë¦¬ì†ŒìŠ¤ ìƒì„¸

# State ì¡°ì‘
terraform state mv old_name new_name    # ë¦¬ì†ŒìŠ¤ ì´ë¦„ ë³€ê²½
terraform state rm aws_instance.temp    # Stateì—ì„œ ì œê±°

# State ê°€ì ¸ì˜¤ê¸°
terraform import aws_instance.web i-1234567890abcdef0
```

---

## ğŸ¯ State íŒŒì¼ì˜ ì—­í• 

### Stateê°€ í•˜ëŠ” ì¼

> [!note] í•µì‹¬ ê¸°ëŠ¥
> State íŒŒì¼ì€ Terraformì˜ **ì§„ì‹¤ì˜ ì›ì²œ(Source of Truth)** ì—­í• ì„ í•©ë‹ˆë‹¤.

```mermaid
graph LR
    A[Configuration<br/>desired state] --> C[Terraform]
    B[State File<br/>current state] --> C
    C --> D[Real Infrastructure<br/>actual state]
    D --> B
```

### ì£¼ìš” ëª©ì 

#### 1. ë¦¬ì†ŒìŠ¤ ì¶”ì  (State Tracking)
- ê´€ë¦¬ ì¤‘ì¸ ë¦¬ì†ŒìŠ¤ ê¸°ë¡
- ë¦¬ì†ŒìŠ¤ ê°„ ê´€ê³„ ì €ì¥
- ì†ì„± ë° ë©”íƒ€ë°ì´í„° ë³´ê´€

#### 2. ë™ì‹œì„± ê´€ë¦¬ (Concurrency Management)
- State Lockingìœ¼ë¡œ ë™ì‹œ ìˆ˜ì • ë°©ì§€
- íŒ€ í˜‘ì—… ì‹œ ì¶©ëŒ ë°©ì§€
- ì¼ê´€ì„± ìˆëŠ” ìƒíƒœ ìœ ì§€

#### 3. ì˜ì¡´ì„± ê´€ë¦¬ (Resource Dependency)
- ë¦¬ì†ŒìŠ¤ ìƒì„±/ì‚­ì œ ìˆœì„œ ê²°ì •
- ì˜ì¡´ì„± ê·¸ë˜í”„ êµ¬ì„±
- ìˆœí™˜ ì˜ì¡´ì„± ë°©ì§€

#### 4. ìƒíƒœ ë³´ì¡´ (State Preservation)
- ì‹¤í–‰ ê°„ ìƒíƒœ ìœ ì§€
- ì ì§„ì  ë³€ê²½ ê°€ëŠ¥
- ë³€ê²½ ì´ë ¥ ì¶”ì 

---

## ğŸ“‚ State íŒŒì¼ êµ¬ì¡°

### terraform.tfstate ì˜ˆì‹œ

> [!warning] ë¯¼ê° ì •ë³´ í¬í•¨
> State íŒŒì¼ì—ëŠ” íŒ¨ìŠ¤ì›Œë“œ, API í‚¤ ë“± ë¯¼ê°í•œ ì •ë³´ê°€ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
{
  "version": 4,
  "terraform_version": "1.5.0",
  "serial": 42,
  "lineage": "8b5c6d6f-9f3e-4f3e-8f3e-9f3e4f3e8f3e",
  "outputs": {
    "instance_ip": {
      "value": "192.168.1.100",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "managed",
      "type": "aws_instance",
      "name": "web",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "ami": "ami-0c55b159cbfafe1f0",
            "instance_type": "t2.micro",
            "public_ip": "52.14.100.200",
            "tags": {
              "Name": "WebServer"
            }
          },
          "dependencies": [
            "aws_security_group.web"
          ]
        }
      ]
    }
  ]
}
```

### State íŒŒì¼ ë©”íƒ€ë°ì´í„°

| í•„ë“œ | ì„¤ëª… | ìš©ë„ |
|------|------|------|
| `version` | State íŒŒì¼ í˜•ì‹ ë²„ì „ | í˜¸í™˜ì„± í™•ì¸ |
| `terraform_version` | ì‚¬ìš©ëœ Terraform ë²„ì „ | ë²„ì „ ì¶”ì  |
| `serial` | State ë³€ê²½ ì¼ë ¨ë²ˆí˜¸ | ë™ì‹œì„± ì œì–´ |
| `lineage` | State íŒŒì¼ ê³ ìœ  ID | íŒŒì¼ ì‹ë³„ |
| `outputs` | ì¶œë ¥ ê°’ | ëª¨ë“ˆ ê°„ ë°ì´í„° ì „ë‹¬ |
| `resources` | ë¦¬ì†ŒìŠ¤ ìƒíƒœ | ì‹¤ì œ ì¸í”„ë¼ ë§¤í•‘ |

---

## ğŸ”’ ë¡œì»¬ vs ì›ê²© State

### ë¡œì»¬ Stateì˜ ë¬¸ì œì 

> [!failure] í˜‘ì—… ì‹œ ë¬¸ì œ
> ```
> ê°œë°œì A â† X â†’ terraform.tfstate â† X â†’ ê°œë°œì B
>                       â†“ â†‘
>                    ê°œë°œì C
> ```
> - ë™ê¸°í™” ë¬¸ì œ
> - ì¶©ëŒ ê°€ëŠ¥ì„±
> - ë²„ì „ ê´€ë¦¬ ì–´ë ¤ì›€

### Remote Stateì˜ ì¥ì 

> [!success] ì¤‘ì•™ ì§‘ì¤‘ì‹ ê´€ë¦¬
> ```
> ê°œë°œì A â† â†’ Remote Backend â† â†’ ê°œë°œì B
>                    â†“ â†‘
>                 ê°œë°œì C
> ```
> - ìë™ ë™ê¸°í™”
> - State Locking
> - ë²„ì „ ì´ë ¥ ê´€ë¦¬

### ë¹„êµí‘œ

| íŠ¹ì„± | Local State | Remote State |
|------|-------------|--------------|
| **ì €ì¥ ìœ„ì¹˜** | ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œ | ì›ê²© ì €ì¥ì†Œ |
| **í˜‘ì—…** | ì–´ë ¤ì›€ | ì‰¬ì›€ |
| **ì ê¸ˆ** | ì—†ìŒ | ìë™ ì ê¸ˆ |
| **ë°±ì—…** | ìˆ˜ë™ | ìë™ |
| **ë³´ì•ˆ** | ë‚®ìŒ | ë†’ìŒ (ì•”í˜¸í™”) |
| **ì„¤ì •** | ê°„ë‹¨ | ì¶”ê°€ ì„¤ì • í•„ìš” |

---

## â˜ï¸ Remote Backend ì„¤ì •

### AWS S3 Backend

> [!example] S3 + DynamoDB ì„¤ì •
> ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” Remote Backend êµ¬ì„±ì…ë‹ˆë‹¤.

```hcl
# backend.tf
terraform {
  backend "s3" {
    bucket         = "my-terraform-state"
    key            = "prod/terraform.tfstate"
    region         = "us-west-2"
    
    # State Locking
    dynamodb_table = "terraform-state-lock"
    
    # ì•”í˜¸í™”
    encrypt        = true
    
    # ë²„ì „ ê´€ë¦¬
    versioning     = true
  }
}
```

#### DynamoDB í…Œì´ë¸” ìƒì„±

```hcl
resource "aws_dynamodb_table" "terraform_locks" {
  name         = "terraform-state-lock"
  billing_mode = "PAY_PER_REQUEST"
  hash_key     = "LockID"
  
  attribute {
    name = "LockID"
    type = "S"
  }
  
  tags = {
    Name        = "Terraform State Lock"
    Environment = "Production"
  }
}
```

#### S3 ë²„í‚· ìƒì„±

```hcl
resource "aws_s3_bucket" "terraform_state" {
  bucket = "my-terraform-state"
  
  lifecycle {
    prevent_destroy = true
  }
  
  tags = {
    Name        = "Terraform State"
    Environment = "Production"
  }
}

resource "aws_s3_bucket_versioning" "terraform_state" {
  bucket = aws_s3_bucket.terraform_state.id
  
  versioning_configuration {
    status = "Enabled"
  }
}

resource "aws_s3_bucket_server_side_encryption_configuration" "terraform_state" {
  bucket = aws_s3_bucket.terraform_state.id
  
  rule {
    apply_server_side_encryption_by_default {
      sse_algorithm = "AES256"
    }
  }
}

resource "aws_s3_bucket_public_access_block" "terraform_state" {
  bucket = aws_s3_bucket.terraform_state.id
  
  block_public_acls       = true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}
```

### ë‹¤ë¥¸ Backend ì˜µì…˜

#### Azure Storage Backend

```hcl
terraform {
  backend "azurerm" {
    resource_group_name  = "terraform-state-rg"
    storage_account_name = "tfstate12345"
    container_name      = "tfstate"
    key                 = "prod.terraform.tfstate"
  }
}
```

#### Google Cloud Storage Backend

```hcl
terraform {
  backend "gcs" {
    bucket = "my-terraform-state"
    prefix = "terraform/state"
  }
}
```

#### Terraform Cloud Backend

```hcl
terraform {
  cloud {
    organization = "my-org"
    
    workspaces {
      name = "my-workspace"
    }
  }
}
```

---

## ğŸ¤ í˜‘ì—… ì „ëµ

### State Locking

> [!tip] ìë™ ì ê¸ˆ ë©”ì»¤ë‹ˆì¦˜
> Remote BackendëŠ” ì‘ì—… ì‹œì‘ ì‹œ ìë™ìœ¼ë¡œ Stateë¥¼ ì ê·¸ê³ , ì™„ë£Œ í›„ í•´ì œí•©ë‹ˆë‹¤.

```bash
# ì ê¸ˆ ìƒíƒœ í™•ì¸
terraform plan

# ì¶œë ¥ ì˜ˆì‹œ
Acquiring state lock. This may take a few moments...

# ì ê¸ˆ ì¶©ëŒ ì‹œ
Error: Error acquiring the state lock
Another process is holding the lock.

# ê°•ì œ ì ê¸ˆ í•´ì œ (ì£¼ì˜!)
terraform force-unlock LOCK_ID
```

### Workspace í™œìš©

```bash
# Workspace ìƒì„±
terraform workspace new dev
terraform workspace new staging
terraform workspace new prod

# Workspace ì „í™˜
terraform workspace select prod

# Workspace ëª©ë¡
terraform workspace list
  default
  dev
  staging
* prod

# Workspaceë³„ State íŒŒì¼
# s3://bucket/env:/dev/terraform.tfstate
# s3://bucket/env:/staging/terraform.tfstate
# s3://bucket/env:/prod/terraform.tfstate
```

### í™˜ê²½ë³„ Backend ì„¤ì •

```hcl
# backend-dev.hcl
bucket = "my-terraform-state-dev"
key    = "terraform.tfstate"
region = "us-west-2"

# backend-prod.hcl
bucket = "my-terraform-state-prod"
key    = "terraform.tfstate"
region = "us-west-2"
```

```bash
# í™˜ê²½ë³„ ì´ˆê¸°í™”
terraform init -backend-config=backend-dev.hcl
terraform init -backend-config=backend-prod.hcl
```

---

## ğŸ› ï¸ State ê´€ë¦¬ ëª…ë ¹ì–´

### ì¡°íšŒ ëª…ë ¹ì–´

```bash
# ì „ì²´ State ë³´ê¸°
terraform show

# JSON í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
terraform show -json

# ë¦¬ì†ŒìŠ¤ ëª©ë¡
terraform state list

# íŠ¹ì • ë¦¬ì†ŒìŠ¤ ìƒì„¸
terraform state show aws_instance.web

# ëª¨ë“ˆ ë‚´ ë¦¬ì†ŒìŠ¤
terraform state list module.vpc
```

### ìˆ˜ì • ëª…ë ¹ì–´

> [!warning] ìœ„í—˜í•œ ì‘ì—…
> State ì§ì ‘ ìˆ˜ì •ì€ ì‹ ì¤‘í•˜ê²Œ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ë°±ì—…ì„ ë¨¼ì € ë§Œë“œì„¸ìš”.

```bash
# State ë°±ì—…
terraform state pull > backup.tfstate

# ë¦¬ì†ŒìŠ¤ ì´ë¦„ ë³€ê²½
terraform state mv aws_instance.old aws_instance.new

# ëª¨ë“ˆë¡œ ì´ë™
terraform state mv aws_instance.web module.compute.aws_instance.web

# Stateì—ì„œ ì œê±° (ì‹¤ì œ ë¦¬ì†ŒìŠ¤ëŠ” ìœ ì§€)
terraform state rm aws_instance.obsolete

# ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ ê°€ì ¸ì˜¤ê¸°
terraform import aws_instance.existing i-1234567890abcdef0
```

### Remote State ë°ì´í„° ì†ŒìŠ¤

```hcl
# ë‹¤ë¥¸ State ì°¸ì¡°
data "terraform_remote_state" "network" {
  backend = "s3"
  
  config = {
    bucket = "terraform-state"
    key    = "network/terraform.tfstate"
    region = "us-west-2"
  }
}

# ì°¸ì¡° ì‚¬ìš©
resource "aws_instance" "app" {
  subnet_id = data.terraform_remote_state.network.outputs.private_subnet_ids[0]
}
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­ê³¼ Best Practices

### ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

> [!danger] ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ
> - âŒ State íŒŒì¼ì„ Gitì— ì»¤ë°‹
> - âŒ ì•”í˜¸í™” ì—†ì´ State ì €ì¥
> - âŒ Public ì ‘ê·¼ í—ˆìš©
> - âŒ ë°±ì—… ì—†ì´ State ìˆ˜ì •

### .gitignore ì„¤ì •

```gitignore
# Terraform State
*.tfstate
*.tfstate.*
*.tfstate.backup

# Terraform directories
.terraform/
.terraform.lock.hcl

# Override files
override.tf
override.tf.json
*_override.tf
*_override.tf.json

# CLI config
.terraformrc
terraform.rc
```

### State ë§ˆì´ê·¸ë ˆì´ì…˜

> [!tip] Backend ë³€ê²½ ì ˆì°¨
> Backendë¥¼ ë³€ê²½í•  ë•ŒëŠ” State ë§ˆì´ê·¸ë ˆì´ì…˜ì´ í•„ìš”í•©ë‹ˆë‹¤.

```bash
# 1. í˜„ì¬ State ë°±ì—…
terraform state pull > terraform.tfstate.backup

# 2. Backend ì„¤ì • ë³€ê²½
# backend.tf ìˆ˜ì •

# 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
terraform init -migrate-state

# 4. í™•ì¸
terraform state list
```

### ì¬í•´ ë³µêµ¬

```bash
# State ë³µêµ¬
terraform state push backup.tfstate

# íŠ¹ì • ì‹œì ìœ¼ë¡œ ë³µêµ¬ (S3 ë²„ì „ ê´€ë¦¬ ì‚¬ìš© ì‹œ)
aws s3api get-object \
  --bucket my-terraform-state \
  --key prod/terraform.tfstate \
  --version-id "IYV3p45BT0YWISlmdylYnLabfGbDae.e" \
  terraform.tfstate

# State ì¬êµ¬ì„±
terraform refresh
```

### Best Practices ì²´í¬ë¦¬ìŠ¤íŠ¸

> [!success] ê¶Œì¥ ì‚¬í•­
> - âœ… Remote Backend ì‚¬ìš©
> - âœ… State Locking í™œì„±í™”
> - âœ… ì•”í˜¸í™” ì„¤ì •
> - âœ… ë²„ì „ ê´€ë¦¬ í™œì„±í™”
> - âœ… ì •ê¸°ì  ë°±ì—…
> - âœ… ì ‘ê·¼ ê¶Œí•œ ìµœì†Œí™”
> - âœ… í™˜ê²½ë³„ State ë¶„ë¦¬
> - âœ… Workspace í™œìš©

---

## ğŸ“š ë‹¤ìŒ ë‹¨ê³„

> [!success] í•™ìŠµ ê²½ë¡œ
> State ê´€ë¦¬ë¥¼ ë§ˆìŠ¤í„°í–ˆë‹¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•˜ì„¸ìš”.

- [[07. Terraform ì†ì„±ê³¼ ì˜ì¡´ì„±]] - ë¦¬ì†ŒìŠ¤ ê´€ê³„ ì´í•´
- [[08. Terraform ëª…ë ¹ì–´]] - CLI ëª…ë ¹ì–´ ë§ˆìŠ¤í„°
- [[09. Terraform ê³ ê¸‰ ê°œë…]] - ê³ ê¸‰ ê¸°ëŠ¥ í•™ìŠµ
- [[00. Terraform í•™ìŠµ ê°€ì´ë“œ]] - ì „ì²´ í•™ìŠµ ë¡œë“œë§µ

---

> [!quote]
> "State is the heart of Terraform. Protect it, version it, and never lose it." - HashiCorp Best Practices

> [!tip] Pro Tip
> State íŒŒì¼ì€ Terraformì˜ ê°€ì¥ ì¤‘ìš”í•œ ìì‚°ì…ë‹ˆë‹¤. Production í™˜ê²½ì—ì„œëŠ” ë°˜ë“œì‹œ Remote Backendë¥¼ ì‚¬ìš©í•˜ê³ , ì•”í˜¸í™”ì™€ ë²„ì „ ê´€ë¦¬ë¥¼ í™œì„±í™”í•˜ì„¸ìš”.