---
tags:
  - terraform
  - variables
  - configuration
  - iac
  - tutorial
created: 2025-01-20
updated: 2025-01-20
aliases:
  - Terraform Variables
  - Input Variables
  - 테라폼 변수
description: Terraform에서 입력 변수를 정의하고 활용하여 동적이고 재사용 가능한 구성을 만드는 방법
status: published
category: tutorial
---

# Terraform 변수 (Input Variables)

> [!info] 개요
> Terraform 변수는 구성을 동적이고 재사용 가능하게 만드는 핵심 기능입니다. 변수를 사용하면 하드코딩된 값을 제거하고, 환경별로 다른 설정을 쉽게 적용할 수 있습니다.

## 📑 목차

- [[#⚡ 빠른 시작]]
- [[#🎯 변수의 역할]]
- [[#📝 변수 타입]]
- [[#🔧 변수 정의 방법]]
- [[#💡 변수 값 설정 방법]]
- [[#🚀 실전 예제]]
- [[#⚠️ 주의사항]]
- [[#📚 다음 단계]]

---

## ⚡ 빠른 시작

> [!example] 기본 변수 사용법
> 가장 간단한 변수 정의와 사용 예제입니다.

```hcl
# variables.tf
variable "region" {
  type    = string
  default = "us-west-2"
}

# main.tf
provider "aws" {
  region = var.region  # 변수 참조
}
```

---

## 🎯 변수의 역할

> [!abstract] 왜 변수를 사용해야 하나요?
> 변수는 Terraform 구성을 더욱 강력하고 유연하게 만듭니다.

### 변수 사용의 이점

| 이점 | 설명 | 예시 |
|------|------|------|
| **재사용성** | 같은 구성을 여러 환경에서 사용 | dev/staging/prod 환경 |
| **유지보수성** | 중앙 집중식 값 관리 | 모든 인스턴스 타입을 한 곳에서 변경 |
| **보안성** | 민감한 정보 분리 | 패스워드를 코드에서 분리 |
| **유연성** | 실행 시 값 변경 가능 | CI/CD에서 동적 값 주입 |
| **검증** | 입력 값 유효성 검사 | 허용된 값만 사용 보장 |

---

## 📝 변수 타입

### 기본 타입 (Primitive Types)

#### string

```hcl
variable "instance_name" {
  type    = string
  default = "my-server"
}
```

#### number

```hcl
variable "instance_count" {
  type    = number
  default = 3
}
```

#### bool

```hcl
variable "enable_monitoring" {
  type    = bool
  default = true
}
```

### 컬렉션 타입 (Collection Types)

#### list

```hcl
variable "availability_zones" {
  type    = list(string)
  default = ["us-west-2a", "us-west-2b", "us-west-2c"]
}

# 사용
resource "aws_instance" "example" {
  availability_zone = var.availability_zones[0]
}
```

#### set

```hcl
variable "allowed_ips" {
  type    = set(string)
  default = ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16"]
}
```

#### map

```hcl
variable "instance_types" {
  type = map(string)
  default = {
    dev  = "t2.micro"
    prod = "t2.large"
  }
}

# 사용
resource "aws_instance" "example" {
  instance_type = var.instance_types["dev"]
}
```

### 구조적 타입 (Structural Types)

#### object

```hcl
variable "server_config" {
  type = object({
    name          = string
    instance_type = string
    ami           = string
    subnet_id     = string
    security_group_ids = list(string)
    tags          = map(string)
  })
  
  default = {
    name          = "my-server"
    instance_type = "t2.micro"
    ami           = "ami-xxxxxxxx"
    subnet_id     = "subnet-xxxxxxxx"
    security_group_ids = ["sg-xxxxxxxx"]
    tags = {
      Environment = "production"
      Application = "my-app"
    }
  }
}

# 사용
resource "aws_instance" "example" {
  ami                    = var.server_config.ami
  instance_type         = var.server_config.instance_type
  subnet_id             = var.server_config.subnet_id
  vpc_security_group_ids = var.server_config.security_group_ids
  tags                  = var.server_config.tags
}
```

#### tuple

```hcl
variable "database_config" {
  type = tuple([string, number, bool])
  default = ["postgresql", 5432, true]
}

# 사용
output "db_type" {
  value = var.database_config[0]  # "postgresql"
}
```

### 특수 타입

#### any

```hcl
variable "flexible_config" {
  type    = any
  default = {
    name = "example"
    port = 8080
    enabled = true
  }
}
```

---

## 🔧 변수 정의 방법

### 완전한 변수 정의

> [!tip] 모든 속성을 포함한 변수 정의
> 프로덕션 환경에서는 모든 속성을 명시하는 것이 좋습니다.

```hcl
variable "database_password" {
  description = "The password for the database"
  type        = string
  sensitive   = true  # 로그에 표시되지 않음
  
  validation {
    condition     = length(var.database_password) >= 8
    error_message = "Password must be at least 8 characters long."
  }
  
  validation {
    condition = can(regex("^[a-zA-Z0-9!@#$%^&*()_+=-]+$", var.database_password))
    error_message = "Password can only contain alphanumeric characters and special symbols."
  }
}
```

### 변수 검증 (Validation)

```hcl
variable "environment" {
  description = "Deployment environment"
  type        = string
  
  validation {
    condition = contains(["dev", "staging", "prod"], var.environment)
    error_message = "Environment must be dev, staging, or prod."
  }
}

variable "instance_type" {
  description = "EC2 instance type"
  type        = string
  
  validation {
    condition = can(regex("^t[23]\\.(micro|small|medium|large)$", var.instance_type))
    error_message = "Instance type must be t2 or t3 series."
  }
}

variable "port_number" {
  description = "Application port"
  type        = number
  
  validation {
    condition     = var.port_number > 0 && var.port_number <= 65535
    error_message = "Port number must be between 1 and 65535."
  }
}
```

---

## 💡 변수 값 설정 방법

> [!note] 우선순위
> Terraform은 다음 순서로 변수 값을 결정합니다 (낮은 번호가 높은 우선순위):

### 1. 명령줄 -var 옵션

```bash
terraform apply -var="region=us-east-1" -var="instance_count=5"
```

### 2. -var-file 옵션

```bash
terraform apply -var-file="production.tfvars"
```

### 3. terraform.tfvars 파일

```hcl
# terraform.tfvars
region         = "us-west-2"
instance_count = 3
instance_type  = "t2.micro"
```

### 4. *.auto.tfvars 파일

```hcl
# production.auto.tfvars
environment = "production"
monitoring_enabled = true
```

### 5. 환경 변수

```bash
export TF_VAR_region="us-west-2"
export TF_VAR_instance_count=3
```

### 6. 변수 정의의 default 값

```hcl
variable "region" {
  default = "us-west-2"
}
```

### 우선순위 예제

> [!example] 변수 값 결정 과정
> 여러 소스에서 같은 변수를 정의할 때의 동작

```hcl
# variables.tf
variable "instance_type" {
  default = "t2.micro"  # 우선순위 6
}

# terraform.tfvars
instance_type = "t2.small"  # 우선순위 3

# production.auto.tfvars
instance_type = "t2.medium"  # 우선순위 4

# 환경 변수
export TF_VAR_instance_type="t2.large"  # 우선순위 5

# 명령줄
terraform apply -var="instance_type=t2.xlarge"  # 우선순위 1 (최종 사용)
```

---

## 🚀 실전 예제

### 환경별 구성 관리

> [!example] 멀티 환경 배포
> dev, staging, production 환경을 변수로 관리하는 예제

#### 프로젝트 구조

```
terraform/
├── main.tf
├── variables.tf
├── outputs.tf
├── environments/
│   ├── dev.tfvars
│   ├── staging.tfvars
│   └── production.tfvars
```

#### variables.tf

```hcl
variable "environment" {
  description = "Environment name"
  type        = string
}

variable "region" {
  description = "AWS region"
  type        = string
  default     = "us-west-2"
}

variable "instance_config" {
  description = "Instance configuration per environment"
  type = object({
    instance_type   = string
    instance_count  = number
    enable_monitoring = bool
    enable_backup    = bool
  })
}

variable "network_config" {
  description = "Network configuration"
  type = object({
    vpc_cidr     = string
    subnet_cidrs = list(string)
    enable_nat   = bool
  })
}

variable "tags" {
  description = "Resource tags"
  type        = map(string)
  default     = {}
}
```

#### environments/dev.tfvars

```hcl
environment = "dev"
region      = "us-west-2"

instance_config = {
  instance_type     = "t2.micro"
  instance_count    = 1
  enable_monitoring = false
  enable_backup     = false
}

network_config = {
  vpc_cidr     = "10.0.0.0/16"
  subnet_cidrs = ["10.0.1.0/24", "10.0.2.0/24"]
  enable_nat   = false
}

tags = {
  Environment = "Development"
  Team        = "DevOps"
  CostCenter  = "Engineering"
}
```

#### environments/production.tfvars

```hcl
environment = "prod"
region      = "us-east-1"

instance_config = {
  instance_type     = "t2.large"
  instance_count    = 3
  enable_monitoring = true
  enable_backup     = true
}

network_config = {
  vpc_cidr     = "10.1.0.0/16"
  subnet_cidrs = ["10.1.1.0/24", "10.1.2.0/24", "10.1.3.0/24"]
  enable_nat   = true
}

tags = {
  Environment = "Production"
  Team        = "DevOps"
  CostCenter  = "Operations"
  Compliance  = "PCI-DSS"
}
```

#### main.tf

```hcl
locals {
  common_tags = merge(
    var.tags,
    {
      ManagedBy   = "Terraform"
      Environment = var.environment
      Region      = var.region
    }
  )
}

# VPC
resource "aws_vpc" "main" {
  cidr_block = var.network_config.vpc_cidr
  
  tags = merge(local.common_tags, {
    Name = "${var.environment}-vpc"
  })
}

# Subnets
resource "aws_subnet" "main" {
  count = length(var.network_config.subnet_cidrs)
  
  vpc_id     = aws_vpc.main.id
  cidr_block = var.network_config.subnet_cidrs[count.index]
  
  tags = merge(local.common_tags, {
    Name = "${var.environment}-subnet-${count.index + 1}"
  })
}

# EC2 Instances
resource "aws_instance" "app" {
  count = var.instance_config.instance_count
  
  ami           = data.aws_ami.amazon_linux.id
  instance_type = var.instance_config.instance_type
  subnet_id     = aws_subnet.main[count.index % length(aws_subnet.main)].id
  
  monitoring = var.instance_config.enable_monitoring
  
  tags = merge(local.common_tags, {
    Name = "${var.environment}-app-${count.index + 1}"
  })
}

# Backup (조건부)
resource "aws_backup_plan" "main" {
  count = var.instance_config.enable_backup ? 1 : 0
  
  name = "${var.environment}-backup-plan"
  
  rule {
    rule_name         = "daily_backup"
    target_vault_name = aws_backup_vault.main[0].name
    schedule          = "cron(0 5 ? * * *)"
    
    lifecycle {
      delete_after = 30
    }
  }
  
  tags = local.common_tags
}

resource "aws_backup_vault" "main" {
  count = var.instance_config.enable_backup ? 1 : 0
  
  name = "${var.environment}-backup-vault"
  tags = local.common_tags
}
```

#### 배포 명령어

```bash
# 개발 환경 배포
terraform plan -var-file="environments/dev.tfvars"
terraform apply -var-file="environments/dev.tfvars"

# 프로덕션 환경 배포
terraform plan -var-file="environments/production.tfvars"
terraform apply -var-file="environments/production.tfvars"
```

### 민감한 변수 관리

> [!warning] 보안 주의사항
> 민감한 정보는 특별히 주의해서 다루어야 합니다.

```hcl
# variables.tf
variable "db_username" {
  description = "Database administrator username"
  type        = string
  sensitive   = true
}

variable "db_password" {
  description = "Database administrator password"  
  type        = string
  sensitive   = true
}

variable "api_keys" {
  description = "API keys for external services"
  type = map(string)
  sensitive = true
}

# main.tf
resource "aws_db_instance" "database" {
  username = var.db_username
  password = var.db_password
  
  # sensitive 변수는 로그에 마스킹됨
}

# 환경 변수로 설정
export TF_VAR_db_username="admin"
export TF_VAR_db_password="SuperSecret123!"
export TF_VAR_api_keys='{"stripe":"sk_test_xxx","sendgrid":"SG.xxx"}'
```

---

## ⚠️ 주의사항

> [!danger] 흔한 실수와 해결 방법
> 변수 사용 시 자주 발생하는 문제들입니다.

### 1. 민감한 정보 노출

```hcl
# ❌ 잘못된 예
variable "password" {
  default = "admin123"  # 절대 이렇게 하지 마세요!
}

# ✅ 올바른 예
variable "password" {
  description = "Database password"
  type        = string
  sensitive   = true
  # default 값 없음 - 실행 시 입력 받음
}
```

### 2. 타입 불일치

```hcl
# ❌ 잘못된 예
variable "ports" {
  type = list(number)
}
# terraform.tfvars
ports = ["80", "443"]  # 문자열이므로 오류!

# ✅ 올바른 예
ports = [80, 443]  # 숫자로 지정
```

### 3. 순환 참조

```hcl
# ❌ 잘못된 예 - 순환 참조 오류
variable "name" {
  default = var.prefix  # 변수는 다른 변수를 참조할 수 없음
}

# ✅ 올바른 예 - locals 사용
variable "prefix" {
  default = "my"
}

locals {
  name = "${var.prefix}-app"
}
```

### 4. 변수 파일 보안

```bash
# .gitignore
*.tfvars       # 모든 tfvars 파일 제외
!example.tfvars # 예제 파일은 포함

# 민감한 변수는 환경 변수나 시크릿 관리 도구 사용
```

---

## 📚 다음 단계

> [!success] 학습 경로
> 변수를 마스터했다면 다음 주제로 진행하세요.

### 관련 문서

- [[05. Terraform 출력 변수 (Output)]] - 변수의 출력 버전
- [[Terraform Provider 관리]] - Provider별 변수 설정
- [[Terraform 상태 관리]] - 변수와 State의 관계
- [[07. Terraform 고급 개념#Data Sources]] - 외부 데이터를 변수처럼 사용

### 실습 과제

1. **기본 실습**: 3개의 다른 타입 변수를 정의하고 사용해보기
2. **검증 실습**: validation 블록을 사용한 입력 검증 구현
3. **환경 분리**: dev/prod 환경을 변수로 분리하여 구성
4. **민감 정보**: sensitive 변수로 패스워드 관리하기

---

> [!quote]
> "Variables are the key to making your Terraform configurations flexible and reusable. Master them, and you master infrastructure as code." - HashiCorp

> [!tip] Pro Tip
> 변수 이름은 명확하고 일관성 있게 작성하세요. `instance_type`이 `ec2_type`보다 더 직관적입니다. 팀 내에서 네이밍 컨벤션을 정하고 따르는 것이 중요합니다.