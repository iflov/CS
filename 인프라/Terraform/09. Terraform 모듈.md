---
tags:
- terraform
- modules
- infrastructure
- reusability
- intermediate
created: 2025-01-15
updated: 2025-01-15
aliases:
- Terraform Modules
- 테라폼 모듈
description: Terraform 모듈을 활용한 재사용 가능한 인프라 컴포넌트 작성 가이드
status: published
category: guide
---

# Terraform 모듈

> [!info] 개요
> Terraform 모듈은 재사용 가능한 인프라 컴포넌트를 만들기 위한 핵심 기능입니다. 모듈을 사용하면 복잡한 인프라를 논리적인 단위로 분리하고, 팀 간에 검증된 인프라 패턴을 공유할 수 있습니다. 이 가이드에서는 모듈 작성, 구조화, 배포 방법을 다룹니다.

## 📑 목차

- [[#🎯 모듈이란?]]
- [[#📁 모듈 구조]]
- [[#✍️ 모듈 작성하기]]
- [[#📥 모듈 사용하기]]
- [[#🔄 모듈 간 데이터 전달]]
- [[#📦 모듈 버전 관리]]
- [[#🌍 모듈 레지스트리]]
- [[#🏗️ 실전 모듈 예제]]
- [[#✨ 모듈 베스트 프랙티스]]
- [[#📚 참고자료]]

---

## 🎯 모듈이란?

> [!note] 모듈의 정의
> 모듈은 함께 사용되는 여러 리소스의 컨테이너입니다. 모든 Terraform 구성은 최소한 하나의 모듈(루트 모듈)을 가지며, 다른 모듈을 호출할 수 있습니다.

### 모듈의 장점

- **재사용성**: 한 번 작성한 모듈을 여러 프로젝트에서 사용
- **일관성**: 표준화된 인프라 패턴 유지
- **캡슐화**: 복잡성을 숨기고 간단한 인터페이스 제공
- **유지보수성**: 중앙 집중식 업데이트 가능
- **협업**: 팀 간 검증된 모듈 공유

---

## 📁 모듈 구조

### 표준 모듈 레이아웃

> [!example] 권장 디렉토리 구조
> ```
> modules/
> └── vpc/
>     ├── README.md          # 모듈 문서
>     ├── main.tf           # 주요 리소스 정의
>     ├── variables.tf      # 입력 변수
>     ├── outputs.tf        # 출력 값
>     ├── versions.tf       # 버전 제약
>     ├── examples/         # 사용 예제
>     │   └── basic/
>     │       └── main.tf
>     └── tests/            # 테스트 코드
>         └── basic_test.go
> ```

### 파일별 역할

> [!tip] 파일 컨벤션
> - **main.tf**: 모듈의 핵심 리소스
> - **variables.tf**: 모듈 입력 매개변수
> - **outputs.tf**: 모듈이 반환하는 값
> - **versions.tf**: Terraform 및 Provider 버전 요구사항
> - **README.md**: 모듈 사용법과 예제

---

## ✍️ 모듈 작성하기

### 기본 모듈 작성

> [!example] VPC 모듈 예제
> 
> **modules/vpc/variables.tf**
> ```hcl
> variable "vpc_cidr" {
>   description = "CIDR block for VPC"
>   type        = string
>   default     = "10.0.0.0/16"
> }
> 
> variable "environment" {
>   description = "Environment name"
>   type        = string
>   validation {
>     condition     = contains(["dev", "staging", "prod"], var.environment)
>     error_message = "Environment must be dev, staging, or prod."
>   }
> }
> 
> variable "availability_zones" {
>   description = "List of availability zones"
>   type        = list(string)
>   default     = ["us-west-2a", "us-west-2b"]
> }
> 
> variable "enable_nat_gateway" {
>   description = "Enable NAT Gateway for private subnets"
>   type        = bool
>   default     = true
> }
> 
> variable "tags" {
>   description = "Tags to apply to all resources"
>   type        = map(string)
>   default     = {}
> }
> ```
> 
> **modules/vpc/main.tf**
> ```hcl
> locals {
>   common_tags = merge(
>     var.tags,
>     {
>       Module      = "vpc"
>       Environment = var.environment
>       ManagedBy   = "Terraform"
>     }
>   )
> }
> 
> # VPC
> resource "aws_vpc" "main" {
>   cidr_block           = var.vpc_cidr
>   enable_dns_hostnames = true
>   enable_dns_support   = true
> 
>   tags = merge(
>     local.common_tags,
>     {
>       Name = "${var.environment}-vpc"
>     }
>   )
> }
> 
> # Internet Gateway
> resource "aws_internet_gateway" "main" {
>   vpc_id = aws_vpc.main.id
> 
>   tags = merge(
>     local.common_tags,
>     {
>       Name = "${var.environment}-igw"
>     }
>   )
> }
> 
> # Public Subnets
> resource "aws_subnet" "public" {
>   count = length(var.availability_zones)
> 
>   vpc_id                  = aws_vpc.main.id
>   cidr_block              = cidrsubnet(var.vpc_cidr, 8, count.index)
>   availability_zone       = var.availability_zones[count.index]
>   map_public_ip_on_launch = true
> 
>   tags = merge(
>     local.common_tags,
>     {
>       Name = "${var.environment}-public-${var.availability_zones[count.index]}"
>       Type = "Public"
>     }
>   )
> }
> 
> # Private Subnets
> resource "aws_subnet" "private" {
>   count = length(var.availability_zones)
> 
>   vpc_id            = aws_vpc.main.id
>   cidr_block        = cidrsubnet(var.vpc_cidr, 8, count.index + 100)
>   availability_zone = var.availability_zones[count.index]
> 
>   tags = merge(
>     local.common_tags,
>     {
>       Name = "${var.environment}-private-${var.availability_zones[count.index]}"
>       Type = "Private"
>     }
>   )
> }
> 
> # NAT Gateway
> resource "aws_eip" "nat" {
>   count = var.enable_nat_gateway ? length(var.availability_zones) : 0
> 
>   domain = "vpc"
> 
>   tags = merge(
>     local.common_tags,
>     {
>       Name = "${var.environment}-nat-eip-${count.index}"
>     }
>   )
> }
> 
> resource "aws_nat_gateway" "main" {
>   count = var.enable_nat_gateway ? length(var.availability_zones) : 0
> 
>   allocation_id = aws_eip.nat[count.index].id
>   subnet_id     = aws_subnet.public[count.index].id
> 
>   tags = merge(
>     local.common_tags,
>     {
>       Name = "${var.environment}-nat-${var.availability_zones[count.index]}"
>     }
>   )
> }
> ```
> 
> **modules/vpc/outputs.tf**
> ```hcl
> output "vpc_id" {
>   description = "ID of the VPC"
>   value       = aws_vpc.main.id
> }
> 
> output "vpc_cidr" {
>   description = "CIDR block of the VPC"
>   value       = aws_vpc.main.cidr_block
> }
> 
> output "public_subnet_ids" {
>   description = "List of public subnet IDs"
>   value       = aws_subnet.public[*].id
> }
> 
> output "private_subnet_ids" {
>   description = "List of private subnet IDs"
>   value       = aws_subnet.private[*].id
> }
> 
> output "nat_gateway_ids" {
>   description = "List of NAT Gateway IDs"
>   value       = aws_nat_gateway.main[*].id
> }
> 
> output "internet_gateway_id" {
>   description = "ID of the Internet Gateway"
>   value       = aws_internet_gateway.main.id
> }
> ```

---

## 📥 모듈 사용하기

### 로컬 모듈 호출

> [!example] 모듈 사용 예제
> ```hcl
> module "vpc" {
>   source = "./modules/vpc"
>   
>   vpc_cidr           = "10.0.0.0/16"
>   environment        = "production"
>   availability_zones = ["us-west-2a", "us-west-2b", "us-west-2c"]
>   enable_nat_gateway = true
>   
>   tags = {
>     Project = "MyApp"
>     Owner   = "DevOps Team"
>   }
> }
> 
> # 모듈 출력 사용
> resource "aws_instance" "app" {
>   subnet_id = module.vpc.private_subnet_ids[0]
>   # ...
> }
> ```

### 원격 모듈 소스

> [!tip] 다양한 모듈 소스
> ```hcl
> # Terraform Registry
> module "vpc" {
>   source  = "terraform-aws-modules/vpc/aws"
>   version = "5.0.0"
>   # ...
> }
> 
> # GitHub
> module "vpc" {
>   source = "github.com/example/terraform-modules//vpc?ref=v1.0.0"
>   # ...
> }
> 
> # Git (SSH)
> module "vpc" {
>   source = "git@github.com:example/terraform-modules.git//vpc"
>   # ...
> }
> 
> # HTTP
> module "vpc" {
>   source = "https://example.com/terraform-modules/vpc.zip"
>   # ...
> }
> 
> # S3
> module "vpc" {
>   source = "s3::https://s3-eu-west-1.amazonaws.com/examplebucket/vpc.zip"
>   # ...
> }
> ```

---

## 🔄 모듈 간 데이터 전달

### 모듈 의존성

> [!note] 모듈 체이닝
> ```hcl
> # VPC 모듈
> module "vpc" {
>   source = "./modules/vpc"
>   
>   environment = var.environment
>   vpc_cidr    = var.vpc_cidr
> }
> 
> # Security Group 모듈 (VPC 모듈에 의존)
> module "security_groups" {
>   source = "./modules/security-groups"
>   
>   vpc_id      = module.vpc.vpc_id
>   environment = var.environment
> }
> 
> # EC2 모듈 (VPC와 Security Group 모듈에 의존)
> module "ec2" {
>   source = "./modules/ec2"
>   
>   subnet_ids         = module.vpc.private_subnet_ids
>   security_group_ids = module.security_groups.app_sg_ids
>   environment        = var.environment
> }
> ```

### 조건부 모듈

> [!example] 조건부 모듈 생성
> ```hcl
> # count를 사용한 조건부 모듈
> module "monitoring" {
>   count  = var.enable_monitoring ? 1 : 0
>   source = "./modules/monitoring"
>   
>   environment = var.environment
>   vpc_id      = module.vpc.vpc_id
> }
> 
> # for_each를 사용한 다중 모듈
> module "services" {
>   for_each = var.services
>   source   = "./modules/service"
>   
>   service_name = each.key
>   service_config = each.value
>   vpc_id = module.vpc.vpc_id
> }
> ```

---

## 📦 모듈 버전 관리

### 버전 제약 설정

> [!warning] 버전 고정의 중요성
> ```hcl
> # versions.tf
> terraform {
>   required_version = ">= 1.0"
>   
>   required_providers {
>     aws = {
>       source  = "hashicorp/aws"
>       version = "~> 5.0"
>     }
>   }
> }
> ```

### 모듈 버전 지정

```hcl
module "vpc" {
  source  = "terraform-aws-modules/vpc/aws"
  version = "~> 5.0"  # 5.x 버전만 허용
  
  # 또는 정확한 버전
  # version = "= 5.1.0"
  
  # 또는 범위
  # version = ">= 5.0, < 6.0"
}
```

---

## 🌍 모듈 레지스트리

### Terraform Registry 활용

> [!tip] 공식 모듈 사용
> Terraform Registry에는 검증된 모듈들이 많이 있습니다.

```hcl
# AWS VPC 모듈
module "vpc" {
  source  = "terraform-aws-modules/vpc/aws"
  version = "5.0.0"
  
  name = "my-vpc"
  cidr = "10.0.0.0/16"
  
  azs             = ["us-west-2a", "us-west-2b"]
  private_subnets = ["10.0.1.0/24", "10.0.2.0/24"]
  public_subnets  = ["10.0.101.0/24", "10.0.102.0/24"]
  
  enable_nat_gateway = true
  enable_vpn_gateway = true
}

# AWS RDS 모듈
module "db" {
  source  = "terraform-aws-modules/rds/aws"
  version = "6.0.0"
  
  identifier = "demodb"
  
  engine            = "mysql"
  engine_version    = "8.0"
  instance_class    = "db.t3.micro"
  allocated_storage = 20
  
  db_name  = "mydb"
  username = "admin"
  port     = "3306"
  
  vpc_security_group_ids = [module.security_group.security_group_id]
  subnet_ids             = module.vpc.database_subnet_ids
}
```

### 프라이빗 모듈 레지스트리

> [!note] Terraform Cloud/Enterprise
> 조직 내부용 프라이빗 모듈 레지스트리를 구축할 수 있습니다.

```hcl
module "vpc" {
  source  = "app.terraform.io/example-corp/vpc/aws"
  version = "1.0.0"
  
  # 설정...
}
```

---

## 🏗️ 실전 모듈 예제

### 3-Tier 웹 애플리케이션 모듈

> [!example] 완전한 웹 애플리케이션 인프라
> ```hcl
> # main.tf - 루트 모듈
> 
> # 네트워크 레이어
> module "network" {
>   source = "./modules/network"
>   
>   environment        = var.environment
>   vpc_cidr          = var.vpc_cidr
>   availability_zones = var.availability_zones
> }
> 
> # 데이터베이스 레이어
> module "database" {
>   source = "./modules/database"
>   
>   environment    = var.environment
>   subnet_ids     = module.network.database_subnet_ids
>   vpc_id         = module.network.vpc_id
>   instance_class = var.db_instance_class
>   
>   backup_retention_period = var.environment == "prod" ? 30 : 7
>   multi_az               = var.environment == "prod" ? true : false
> }
> 
> # 애플리케이션 레이어
> module "application" {
>   source = "./modules/application"
>   
>   environment         = var.environment
>   subnet_ids          = module.network.app_subnet_ids
>   vpc_id              = module.network.vpc_id
>   database_endpoint   = module.database.endpoint
>   
>   instance_type   = var.app_instance_type
>   min_size        = var.app_min_size
>   max_size        = var.app_max_size
>   desired_capacity = var.app_desired_capacity
> }
> 
> # 로드 밸런서
> module "load_balancer" {
>   source = "./modules/alb"
>   
>   environment     = var.environment
>   subnet_ids      = module.network.public_subnet_ids
>   vpc_id          = module.network.vpc_id
>   certificate_arn = var.certificate_arn
>   
>   target_group_arns = [module.application.target_group_arn]
> }
> 
> # 모니터링
> module "monitoring" {
>   source = "./modules/monitoring"
>   
>   environment = var.environment
>   
>   alb_arn             = module.load_balancer.arn
>   database_identifier = module.database.identifier
>   asg_name           = module.application.asg_name
>   
>   alert_email = var.alert_email
> }
> ```

### 재사용 가능한 컴포넌트 모듈

> [!tip] S3 버킷 모듈
> ```hcl
> # modules/s3-bucket/main.tf
> 
> resource "aws_s3_bucket" "this" {
>   bucket = var.bucket_name
>   
>   tags = var.tags
> }
> 
> resource "aws_s3_bucket_versioning" "this" {
>   count = var.enable_versioning ? 1 : 0
>   
>   bucket = aws_s3_bucket.this.id
>   
>   versioning_configuration {
>     status = "Enabled"
>   }
> }
> 
> resource "aws_s3_bucket_encryption" "this" {
>   bucket = aws_s3_bucket.this.id
>   
>   rule {
>     apply_server_side_encryption_by_default {
>       sse_algorithm     = var.encryption_algorithm
>       kms_master_key_id = var.kms_key_id
>     }
>   }
> }
> 
> resource "aws_s3_bucket_public_access_block" "this" {
>   bucket = aws_s3_bucket.this.id
>   
>   block_public_acls       = true
>   block_public_policy     = true
>   ignore_public_acls      = true
>   restrict_public_buckets = true
> }
> 
> resource "aws_s3_bucket_lifecycle_configuration" "this" {
>   count = length(var.lifecycle_rules) > 0 ? 1 : 0
>   
>   bucket = aws_s3_bucket.this.id
>   
>   dynamic "rule" {
>     for_each = var.lifecycle_rules
>     
>     content {
>       id     = rule.value.id
>       status = rule.value.enabled ? "Enabled" : "Disabled"
>       
>       transition {
>         days          = rule.value.transition_days
>         storage_class = rule.value.storage_class
>       }
>       
>       expiration {
>         days = rule.value.expiration_days
>       }
>     }
>   }
> }
> ```

---

## ✨ 모듈 베스트 프랙티스

### 설계 원칙

> [!success] 모듈 설계 가이드라인
> 1. **단일 책임 원칙**: 각 모듈은 하나의 명확한 목적을 가져야 함
> 2. **입력 검증**: variable validation 블록 활용
> 3. **합리적인 기본값**: 대부분의 경우에 작동하는 기본값 제공
> 4. **명확한 출력**: 필요한 모든 값을 출력으로 노출
> 5. **문서화**: README.md와 description 속성 활용

### 네이밍 컨벤션

> [!tip] 일관된 네이밍
> ```hcl
> # 변수 네이밍
> variable "instance_type" { }     # snake_case
> variable "enable_monitoring" { } # bool은 enable_, create_, use_ 접두사
> 
> # 출력 네이밍
> output "instance_id" { }         # 단수
> output "subnet_ids" { }          # 복수
> 
> # 리소스 네이밍
> resource "aws_instance" "this" { }     # 단일 리소스
> resource "aws_instance" "main" { }     # 주요 리소스
> resource "aws_subnet" "private" { }    # 용도별 이름
> ```

### 모듈 테스팅

> [!warning] 테스트의 중요성
> ```hcl
> # examples/complete/main.tf
> module "test" {
>   source = "../../"
>   
>   # 모든 변수에 대한 완전한 예제
>   vpc_cidr           = "10.0.0.0/16"
>   environment        = "test"
>   availability_zones = ["us-west-2a", "us-west-2b"]
>   enable_nat_gateway = true
>   
>   tags = {
>     Test = "true"
>   }
> }
> 
> output "test_results" {
>   value = {
>     vpc_id     = module.test.vpc_id
>     subnet_ids = module.test.public_subnet_ids
>   }
> }
> ```

### 버전 관리 전략

> [!note] Semantic Versioning
> - **MAJOR (1.0.0)**: 하위 호환성이 깨지는 변경
> - **MINOR (0.1.0)**: 하위 호환성 유지하며 기능 추가
> - **PATCH (0.0.1)**: 버그 수정

---

## 📚 참고자료

### 관련 문서
- [[Terraform 기초]]
- [[08. Terraform 함수]]
- [[Terraform 변수 (Input Variables)]]
- [[Terraform 출력 변수 (Output)]]

### 외부 리소스
- [Terraform Module Registry](https://registry.terraform.io/browse/modules)
- [Terraform Module 공식 문서](https://www.terraform.io/docs/language/modules/index.html)
- [Module Composition](https://www.terraform.io/docs/language/modules/develop/composition.html)
- [Publishing Modules](https://www.terraform.io/docs/registry/modules/publish.html)

---

> [!quote]
> "좋은 모듈은 복잡성을 숨기고 간단한 인터페이스를 제공합니다. 훌륭한 모듈은 그것을 우아하게 해냅니다."