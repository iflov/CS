---
tags:
- terraform
- functions
- hcl
- infrastructure
- intermediate
created: 2025-01-15
updated: 2025-01-15
aliases:
- Terraform Functions
- 테라폼 함수
description: Terraform에서 사용할 수 있는 Built-in 함수들의 완벽 가이드
status: published
category: reference
---

# Terraform 함수

> [!info] 개요
> Terraform은 HCL 표현식에서 사용할 수 있는 다양한 내장 함수를 제공합니다. 이 함수들을 활용하면 동적이고 유연한 인프라 코드를 작성할 수 있습니다. 문자열 조작, 숫자 연산, 컬렉션 처리 등 다양한 작업을 수행할 수 있습니다.

## 📑 목차

- [[#🔤 문자열 함수]]
- [[#🔢 숫자 함수]]
- [[#📦 컬렉션 함수]]
- [[#📅 날짜/시간 함수]]
- [[#🔐 해시/암호화 함수]]
- [[#📁 파일시스템 함수]]
- [[#🌐 네트워크 함수]]
- [[#🔄 타입 변환 함수]]
- [[#💡 실전 활용 예제]]
- [[#📚 참고자료]]

---

## 🔤 문자열 함수

### 기본 문자열 조작

> [!example] 자주 사용되는 문자열 함수
> ```hcl
> # format - 문자열 포맷팅
> name = format("web-server-%03d", count.index + 1)
> # 결과: "web-server-001", "web-server-002", ...
> 
> # join - 리스트를 문자열로 결합
> tags = join(",", ["web", "production", "public"])
> # 결과: "web,production,public"
> 
> # split - 문자열을 리스트로 분할
> list = split(",", "a,b,c")
> # 결과: ["a", "b", "c"]
> 
> # replace - 문자열 치환
> modified = replace("hello world", "world", "terraform")
> # 결과: "hello terraform"
> 
> # substr - 부분 문자열 추출
> substring = substr("hello world", 0, 5)
> # 결과: "hello"
> ```

### 대소문자 변환

```hcl
# upper - 대문자 변환
env_upper = upper(var.environment)  # "prod" → "PROD"

# lower - 소문자 변환
env_lower = lower(var.environment)  # "PROD" → "prod"

# title - 첫 글자 대문자
title_case = title("hello world")  # "Hello World"
```

### 문자열 검증 및 정리

> [!tip] 문자열 정리 함수
> ```hcl
> # trim - 양쪽 공백 제거
> cleaned = trim("  hello  ")  # "hello"
> 
> # trimprefix - 접두사 제거
> without_prefix = trimprefix("aws-instance", "aws-")  # "instance"
> 
> # trimsuffix - 접미사 제거
> without_suffix = trimsuffix("file.txt", ".txt")  # "file"
> 
> # chomp - 끝의 줄바꿈 제거
> clean_text = chomp("hello\n")  # "hello"
> ```

### 정규표현식

```hcl
# regex - 정규표현식 매칭
result = regex("(?P<before>[a-z]+).(?P<after>[a-z]+)", "hello.world")
# 결과: {before = "hello", after = "world"}

# regexall - 모든 매칭 찾기
matches = regexall("[0-9]+", "test123and456")
# 결과: ["123", "456"]

# can - 표현식 유효성 검사 (에러 없으면 true)
is_valid = can(regex("[0-9]+", var.input))
```

---

## 🔢 숫자 함수

### 기본 수학 함수

> [!example] 수학 연산
> ```hcl
> # abs - 절대값
> absolute = abs(-42)  # 42
> 
> # ceil - 올림
> rounded_up = ceil(4.1)  # 5
> 
> # floor - 내림
> rounded_down = floor(4.9)  # 4
> 
> # round - 반올림
> rounded = round(4.5)  # 5
> 
> # max - 최대값
> maximum = max(5, 10, 3)  # 10
> 
> # min - 최소값
> minimum = min(5, 10, 3)  # 3
> 
> # pow - 거듭제곱
> power = pow(2, 3)  # 8
> 
> # signum - 부호 (-1, 0, 1)
> sign = signum(-5)  # -1
> ```

### 로그 함수

```hcl
# log - 자연로그
natural_log = log(2.718)  # 약 1

# log10 - 상용로그
common_log = log(100, 10)  # 2
```

---

## 📦 컬렉션 함수

### 리스트 함수

> [!tip] 리스트 조작
> ```hcl
> # length - 길이
> size = length(["a", "b", "c"])  # 3
> 
> # concat - 리스트 결합
> combined = concat(["a", "b"], ["c", "d"])  # ["a", "b", "c", "d"]
> 
> # contains - 포함 여부
> has_item = contains(["a", "b", "c"], "b")  # true
> 
> # distinct - 중복 제거
> unique = distinct(["a", "b", "a", "c"])  # ["a", "b", "c"]
> 
> # element - 인덱스로 요소 가져오기 (순환)
> item = element(["a", "b", "c"], 3)  # "a" (3 % 3 = 0)
> 
> # index - 요소의 인덱스 찾기
> position = index(["a", "b", "c"], "b")  # 1
> 
> # reverse - 역순 정렬
> reversed = reverse(["a", "b", "c"])  # ["c", "b", "a"]
> 
> # sort - 정렬
> sorted = sort(["c", "a", "b"])  # ["a", "b", "c"]
> ```

### 맵 함수

> [!example] 맵 조작
> ```hcl
> # keys - 키 목록
> map_keys = keys({a = 1, b = 2})  # ["a", "b"]
> 
> # values - 값 목록
> map_values = values({a = 1, b = 2})  # [1, 2]
> 
> # lookup - 키로 값 조회 (기본값 설정 가능)
> value = lookup({a = "apple"}, "a", "default")  # "apple"
> 
> # merge - 맵 병합
> merged = merge(
>   {a = 1, b = 2},
>   {b = 3, c = 4}
> )  # {a = 1, b = 3, c = 4}
> 
> # zipmap - 두 리스트를 맵으로 변환
> map = zipmap(["a", "b"], [1, 2])  # {a = 1, b = 2}
> ```

### 집합 함수

```hcl
# setintersection - 교집합
intersection = setintersection(["a", "b"], ["b", "c"])  # ["b"]

# setunion - 합집합
union = setunion(["a", "b"], ["b", "c"])  # ["a", "b", "c"]

# setsubtract - 차집합
difference = setsubtract(["a", "b", "c"], ["b", "c"])  # ["a"]

# setproduct - 데카르트 곱
product = setproduct(["a", "b"], [1, 2])
# [["a", 1], ["a", 2], ["b", 1], ["b", 2]]
```

### 고급 컬렉션 함수

> [!note] 데이터 변환 함수
> ```hcl
> # flatten - 중첩 리스트 평탄화
> flat = flatten([[1, 2], [3, 4]])  # [1, 2, 3, 4]
> 
> # transpose - 맵 전치
> transposed = transpose({
>   "a" = ["1", "2"],
>   "b" = ["1"]
> })  # {"1" = ["a", "b"], "2" = ["a"]}
> 
> # chunklist - 리스트를 청크로 분할
> chunks = chunklist(["a", "b", "c", "d"], 2)
> # [["a", "b"], ["c", "d"]]
> 
> # slice - 부분 리스트 추출
> subset = slice(["a", "b", "c", "d"], 1, 3)  # ["b", "c"]
> 
> # range - 숫자 범위 생성
> numbers = range(3)  # [0, 1, 2]
> numbers = range(1, 4)  # [1, 2, 3]
> numbers = range(0, 10, 2)  # [0, 2, 4, 6, 8]
> ```

---

## 📅 날짜/시간 함수

> [!example] 시간 관련 함수
> ```hcl
> # timestamp - 현재 UTC 타임스탬프
> current_time = timestamp()  # "2025-01-15T10:30:45Z"
> 
> # formatdate - 날짜 포맷팅
> formatted = formatdate("YYYY-MM-DD", timestamp())
> # "2025-01-15"
> 
> # timeadd - 시간 더하기
> future = timeadd(timestamp(), "24h")  # 24시간 후
> 
> # timecmp - 시간 비교 (-1, 0, 1)
> comparison = timecmp("2025-01-15", "2025-01-16")  # -1
> ```

---

## 🔐 해시/암호화 함수

> [!warning] 암호화 함수 사용 주의
> 이 함수들은 민감한 데이터를 다룰 때 주의해서 사용하세요.

```hcl
# base64encode/decode
encoded = base64encode("hello")  # "aGVsbG8="
decoded = base64decode("aGVsbG8=")  # "hello"

# jsonencode/decode
json_string = jsonencode({name = "terraform"})  # '{"name":"terraform"}'
json_object = jsondecode('{"name":"terraform"}')  # {name = "terraform"}

# yamlencode/decode
yaml_string = yamlencode({name = "terraform"})
yaml_object = yamldecode("name: terraform")

# md5 - MD5 해시
hash_md5 = md5("hello")  # "5d41402abc4b2a76b9719d911017c592"

# sha256 - SHA256 해시
hash_sha = sha256("hello")  # "2cf24dba5fb0a30e26e83b2ac5b9e29..."

# uuid - UUID 생성
unique_id = uuid()  # "a5d3b4e8-3c4d-4b7e-8c1d-9e8f7a6b5c4d"

# bcrypt - 비밀번호 해싱
hashed = bcrypt("password", 10)
```

---

## 📁 파일시스템 함수

> [!tip] 파일 읽기 함수
> ```hcl
> # file - 파일 내용 읽기
> content = file("${path.module}/config.txt")
> 
> # filebase64 - Base64로 파일 읽기
> binary = filebase64("${path.module}/image.png")
> 
> # templatefile - 템플릿 파일 렌더링
> config = templatefile("${path.module}/config.tpl", {
>   instance_type = "t2.micro"
>   region        = "us-west-2"
> })
> 
> # fileset - 파일 패턴 매칭
> configs = fileset("${path.module}", "configs/*.yaml")
> 
> # fileexists - 파일 존재 여부
> exists = fileexists("${path.module}/optional.txt")
> 
> # dirname - 디렉토리 경로
> dir = dirname("/path/to/file.txt")  # "/path/to"
> 
> # basename - 파일명
> name = basename("/path/to/file.txt")  # "file.txt"
> 
> # pathexpand - 경로 확장 (~를 홈 디렉토리로)
> full_path = pathexpand("~/configs")  # "/home/user/configs"
> ```

---

## 🌐 네트워크 함수

> [!example] IP 주소 계산
> ```hcl
> # cidrhost - CIDR에서 특정 호스트 IP
> host_ip = cidrhost("10.0.0.0/16", 256)  # "10.0.1.0"
> 
> # cidrnetmask - 넷마스크 추출
> netmask = cidrnetmask("10.0.0.0/16")  # "255.255.0.0"
> 
> # cidrsubnet - 서브넷 생성
> subnet = cidrsubnet("10.0.0.0/16", 8, 2)  # "10.0.2.0/24"
> 
> # cidrsubnets - 여러 서브넷 생성
> subnets = cidrsubnets("10.0.0.0/16", 4, 4, 8)
> # ["10.0.0.0/20", "10.0.16.0/20", "10.0.32.0/24"]
> ```

---

## 🔄 타입 변환 함수

> [!note] 타입 변환
> ```hcl
> # tostring - 문자열로 변환
> str = tostring(123)  # "123"
> 
> # tonumber - 숫자로 변환
> num = tonumber("123")  # 123
> 
> # tobool - 불리언으로 변환
> bool = tobool("true")  # true
> 
> # tolist - 리스트로 변환
> list = tolist(["a", "b", "c"])
> 
> # toset - 집합으로 변환
> set = toset(["a", "b", "a"])  # ["a", "b"]
> 
> # tomap - 맵으로 변환
> map = tomap({a = 1, b = 2})
> 
> # try - 에러 처리
> result = try(var.optional_value, "default")
> 
> # coalesce - 첫 번째 null이 아닌 값
> value = coalesce(var.primary, var.secondary, "default")
> 
> # coalescelist - 첫 번째 비어있지 않은 리스트
> list = coalescelist(var.list1, var.list2, ["default"])
> ```

---

## 💡 실전 활용 예제

### 동적 태그 생성

> [!example] 환경별 태그 자동 생성
> ```hcl
> locals {
>   common_tags = {
>     Environment = title(var.environment)
>     ManagedBy   = "Terraform"
>     CreatedAt   = formatdate("YYYY-MM-DD", timestamp())
>     Owner       = lower(var.owner_email)
>   }
>   
>   # 조건부 태그 추가
>   production_tags = var.environment == "prod" ? {
>     CriticalSystem = "true"
>     BackupEnabled  = "true"
>   } : {}
>   
>   # 태그 병합
>   all_tags = merge(
>     local.common_tags,
>     local.production_tags,
>     var.additional_tags
>   )
> }
> ```

### 서브넷 자동 계산

> [!tip] VPC 서브넷 자동 분할
> ```hcl
> variable "vpc_cidr" {
>   default = "10.0.0.0/16"
> }
> 
> variable "availability_zones" {
>   default = ["us-west-2a", "us-west-2b", "us-west-2c"]
> }
> 
> locals {
>   # 각 AZ별로 퍼블릭/프라이빗 서브넷 생성
>   public_subnets = [
>     for i, az in var.availability_zones :
>     cidrsubnet(var.vpc_cidr, 8, i)
>   ]
>   
>   private_subnets = [
>     for i, az in var.availability_zones :
>     cidrsubnet(var.vpc_cidr, 8, i + 100)
>   ]
> }
> 
> output "subnets" {
>   value = {
>     public  = local.public_subnets   # ["10.0.0.0/24", "10.0.1.0/24", ...]
>     private = local.private_subnets  # ["10.0.100.0/24", "10.0.101.0/24", ...]
>   }
> }
> ```

### 설정 파일 템플릿

> [!example] 동적 설정 파일 생성
> ```hcl
> # config.tpl 파일
> # server {
> #   listen 80;
> #   server_name ${server_name};
> #   root ${document_root};
> #   
> #   %{ for path in api_endpoints ~}
> #   location ${path} {
> #     proxy_pass http://${api_backend};
> #   }
> #   %{ endfor ~}
> # }
> 
> resource "local_file" "nginx_config" {
>   content = templatefile("${path.module}/config.tpl", {
>     server_name   = var.domain_name
>     document_root = "/var/www/html"
>     api_endpoints = ["/api", "/graphql"]
>     api_backend   = "localhost:3000"
>   })
>   
>   filename = "${path.module}/nginx.conf"
> }
> ```

### 리소스 이름 생성

> [!tip] 일관된 네이밍 컨벤션
> ```hcl
> locals {
>   # 표준 네이밍 포맷: {prefix}-{env}-{type}-{name}-{random}
>   name_prefix = lower(join("-", [
>     var.project_name,
>     var.environment,
>     var.region_short
>   ]))
>   
>   # 리소스별 이름 생성
>   instance_names = [
>     for i in range(var.instance_count) :
>     format("%s-instance-%02d", local.name_prefix, i + 1)
>   ]
>   
>   # 고유 ID 추가
>   bucket_name = "${local.name_prefix}-${substr(uuid(), 0, 8)}"
> }
> ```

---

## 📚 참고자료

### 관련 문서
- [[Terraform 기초]]
- [[Terraform 변수 (Input Variables)]]
- [[Terraform 출력 변수 (Output)]]
- [[Terraform 고급 개념]]

### 외부 리소스
- [Terraform Functions 공식 문서](https://www.terraform.io/docs/language/functions/index.html)
- [Terraform Function 레퍼런스](https://developer.hashicorp.com/terraform/language/functions)
- [Terraform Expression 문서](https://www.terraform.io/docs/language/expressions/index.html)

---

> [!quote]
> "함수는 코드의 표현력을 높이는 도구입니다. Terraform 함수를 마스터하면 더 간결하고 유지보수하기 쉬운 인프라 코드를 작성할 수 있습니다."