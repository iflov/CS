
# âœ… Chapter 5: ZeroMQì™€ ë©€í‹°ìŠ¤ë ˆë“œ (Working with Threads)

> ZeroMQëŠ” ìŠ¤ë ˆë“œ ê°„ í†µì‹ ì—ì„œë„ ë§¤ìš° ê°•ë ¥í•©ë‹ˆë‹¤.  
> ì´ ì¥ì—ì„œëŠ” ZeroMQë¥¼ í™œìš©í•´ **ë©€í‹°ìŠ¤ë ˆë“œ êµ¬ì¡°**ë¥¼ ì–´ë–»ê²Œ ì„¤ê³„í•˜ëŠ”ì§€ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ“Œ ë‹¤ë£° ë‚´ìš©

- ZeroMQì˜ thread-safe ê°œë…
- `inproc://` ì „ì†¡ ë°©ì‹
- ìŠ¤ë ˆë“œ ê°„ í†µì‹  êµ¬ì¡° ì„¤ê³„
- `PAIR` ì†Œì¼“ ì‚¬ìš©ë²•
- ZeroMQ + Thread ì¡°í•© ì˜ˆì œ
- ì•ˆì „í•œ ì¢…ë£Œ ì²˜ë¦¬

---

## ğŸ”’ ZeroMQëŠ” thread-safeí•œê°€ìš”?

### ğŸ’¡ í•µì‹¬ ì •ë¦¬

- **Context(`zmq.Context`)ëŠ” ë©€í‹°ìŠ¤ë ˆë“œ ê³µìœ  ê°€ëŠ¥**
- **ì†Œì¼“(`zmq.Socket`)ì€ ë‹¨ì¼ ìŠ¤ë ˆë“œ ì „ìš©**
  - í•˜ë‚˜ì˜ ì†Œì¼“ì€ ë°˜ë“œì‹œ í•œ ìŠ¤ë ˆë“œì—ì„œë§Œ ì‚¬ìš©í•´ì•¼ í•¨
  - ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì‚¬ìš© ì‹œ ì˜ˆì™¸ ë°œìƒ ë˜ëŠ” ë°ì´í„° ì†ìƒ ê°€ëŠ¥

â¡ï¸ ìŠ¤ë ˆë“œ ê°„ í†µì‹ ì€ ë°˜ë“œì‹œ **ê° ìŠ¤ë ˆë“œì—ì„œ ìì²´ ì†Œì¼“ì„ ìƒì„±**í•´ì•¼ í•©ë‹ˆë‹¤.  
â¡ï¸ ì´ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ `inproc://` ì „ì†¡ ë°©ì‹ì…ë‹ˆë‹¤.

---

## ğŸ”— `inproc://` ì „ì†¡ ë°©ì‹

> ZeroMQì—ì„œ ê°€ì¥ ë¹ ë¥´ê³  íš¨ìœ¨ì ì¸ ì†Œì¼“ ê°„ ì „ì†¡ ë°©ë²•ì…ë‹ˆë‹¤.  
> ê°™ì€ í”„ë¡œì„¸ìŠ¤ ë‚´ì—ì„œ ì‘ë™í•˜ë©°, **ë©”ëª¨ë¦¬ ë³µì‚¬ ì—†ì´ ì§ì ‘ ë²„í¼ ê³µìœ **ë¡œ ë™ì‘í•©ë‹ˆë‹¤.

```text
[Thread A] â†” inproc://pipe â†” [Thread B]
```

- ë°˜ë“œì‹œ **ë™ì¼í•œ context ê°ì²´ë¥¼ ê³µìœ **í•´ì•¼ í•¨
- bind/accept ìˆœì„œ ì¤‘ìš”: bindëŠ” ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼ ì•ˆì „

---

## ğŸ§ª ìŠ¤ë ˆë“œ ê°„ í†µì‹  ì˜ˆì œ

### ğŸ Python ì½”ë“œ: ë©”ì¸ â†’ ì›Œì»¤ ìŠ¤ë ˆë“œë¡œ ë©”ì‹œì§€ ì „ì†¡

```python
import zmq
import threading
import time

ctx = zmq.Context()

# ì›Œì»¤ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë  í•¨ìˆ˜
def worker():
    sock = ctx.socket(zmq.PAIR)
    sock.connect("inproc://pipe")

    while True:
        msg = sock.recv()
        print("[ì›Œì»¤] ìˆ˜ì‹ :", msg.decode())
        if msg == b"exit":
            break

    sock.close()

# ë©”ì¸ ìŠ¤ë ˆë“œ
threading.Thread(target=worker).start()

main_sock = ctx.socket(zmq.PAIR)
main_sock.bind("inproc://pipe")

# ë©”ì‹œì§€ ì „ì†¡
main_sock.send(b"ì‘ì—… ì‹œì‘")
time.sleep(1)
main_sock.send(b"exit")

main_sock.close()
ctx.term()
```

---

## ğŸ§µ PAIR ì†Œì¼“ì˜ íŠ¹ì§•

| íŠ¹ì§•                          | ì„¤ëª… |
|-------------------------------|------|
| 1:1 ì „ìš© ì—°ê²°                  | ë‘ ì†Œì¼“ ê°„ ì§ì ‘ í†µì‹ ë§Œ ì§€ì› |
| REQ/REPì²˜ëŸ¼ ìˆœì„œ ì œí•œ ì—†ìŒ     | ììœ ë¡­ê²Œ send/recv ê°€ëŠ¥ |
| `inproc://`ì™€ í•¨ê»˜ ì‚¬ìš© ì‹œ ìµœì  | ë©€í‹°ìŠ¤ë ˆë“œ ë‚´ë¶€ í†µì‹ ì— ì í•© |

---

## ğŸ§  êµ¬ì¡° ìš”ì•½

```text
[Main Thread]
   â””â”€ bind("inproc://pipe")
           â†•
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ZeroMQ inproc channelâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†•
[Worker Thread]
   â””â”€ connect("inproc://pipe")
```

- ZeroMQ ë‚´ë¶€ì ìœ¼ë¡œ shared queueë¥¼ í†µí•´ ë©”ì‹œì§€ë¥¼ ì „ë‹¬
- contextê°€ ë™ì¼í•´ì•¼ `inproc://` ì‘ë™í•¨

---

## ğŸ§¼ ì•ˆì „í•œ ì¢…ë£Œ ì²˜ë¦¬

> ZeroMQë¥¼ ë©€í‹°ìŠ¤ë ˆë“œì—ì„œ ì‚¬ìš©í•  ë•ŒëŠ” ë‹¤ìŒì„ ìœ ì˜í•˜ì„¸ìš”:

1. **í•­ìƒ ì†Œì¼“ì„ ë¨¼ì € ì¢…ë£Œ â†’ contextë¥¼ ì¢…ë£Œ**
2. **ì“°ë ˆë“œ ì¢…ë£Œ ì‹œ `join()`ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ëŒ€ê¸°**
3. **`recv()`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ blocking â†’ `poll()` ë˜ëŠ” timeout ì„¤ì • ê¶Œì¥**

---

## ğŸ§ª timeout ë˜ëŠ” ë¹„ë™ê¸° ìˆ˜ì‹ 

```python
socket.setsockopt(zmq.RCVTIMEO, 1000)  # 1ì´ˆ timeout

try:
    msg = socket.recv()
except zmq.Again:
    print("ìˆ˜ì‹  íƒ€ì„ì•„ì›ƒ")
```

---

## ğŸ” í™•ì¥ ì˜ˆì‹œ: ë‹¤ì¤‘ ì›Œì»¤ êµ¬ì¡°

```text
[Main Thread] 
   â””â†’ inproc://pipe1 â†’ [Worker 1]
   â””â†’ inproc://pipe2 â†’ [Worker 2]
   â””â†’ ...
```

- ê°ê°ì˜ workerëŠ” ë…ë¦½ì ì¸ ì†Œì¼“/ìŠ¤ë ˆë“œë¡œ êµ¬ì„±ë¨
- push/pull ë˜ëŠ” router/dealer íŒ¨í„´ê³¼ ì¡°í•© ê°€ëŠ¥

---

## ğŸ“Œ ì‹¤ì „ í™œìš© í¬ì¸íŠ¸

- ì›¹ ì„œë²„ì—ì„œ ìš”ì²­ì„ worker ìŠ¤ë ˆë“œë¡œ ë¶„ì‚° ì²˜ë¦¬
- CPU ë°”ìš´ë“œ ì—°ì‚°ì„ ë³„ë„ ìŠ¤ë ˆë“œì— ì˜¤í”„ë¡œë“œ
- I/O ì‘ì—… ë¶„ë¦¬ ì²˜ë¦¬

---

## ğŸ“ ìš”ì•½

| í•­ëª©               | ì„¤ëª…                                 |
|--------------------|--------------------------------------|
| ì†Œì¼“ thread-safe?   | âŒ (ê° ìŠ¤ë ˆë“œì—ì„œ ìƒˆë¡œ ìƒì„±í•´ì•¼ í•¨)       |
| context ê³µìœ  ê°€ëŠ¥?  | âœ…                                  |
| ìŠ¤ë ˆë“œ í†µì‹  ì „ì†¡ë°©ì‹ | `inproc://`                         |
| ì¶”ì²œ ì†Œì¼“ íƒ€ì…      | `PAIR` ë˜ëŠ” `PUSH/PULL`               |
| ì†ë„                | `inproc://` > `ipc://` > `tcp://` ìˆœ |

---

## ğŸ“ ì°¸ê³ 

- Python ZeroMQëŠ” `threading` ëª¨ë“ˆê³¼ ì™„ë²½íˆ í˜¸í™˜ë©ë‹ˆë‹¤.
- `inproc://`ì€ ê°™ì€ context ë‚´ì—ì„œë§Œ ì‘ë™í•©ë‹ˆë‹¤.
- ê³µì‹ ë¬¸ì„œ: [https://zguide.zeromq.org](https://zguide.zeromq.org)